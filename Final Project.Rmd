---
title: "Final Project"
author: "Brenda Yang, Charlie Bonetti, Nour Kanaan"
date: "7/19/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(gdata)
library(tidyverse)
library(sf)
library(readxl)
```

```{r data-variables, echo = FALSE}
dstate = read.xls("data/state depression rates 2020.xls")
astate = read.xls("data/State anxiety trends 2020.xls")
dtrends2020 = read.xls("data/April 2020 depression trends.xls")
dtrends2018 = read.xls("data/April 2018 depression trends.xls")
atrends2020 = read.xls("data/April 2020 anxiety trends.xls")
atrends2018 = read.xls("data/April 2018 anxiety trends.xls")
restrictions = read.csv("data/restriction rankings.csv")
covidrate = read.xls("data/all_data.xls")
```

### Comparing depression trends between April 2020 and April 2018
```{r depression-assumptions-2018, echo = FALSE}
ggplot(data = dtrends2018, mapping = aes(x = depression)) +
  geom_histogram(color = "snow3", fill = "mediumaquamarine", binwidth = 1)+ 
  labs(title = "depression searches by week in April 2020 are not normally distributed", 
       x = "depression searches", 
       y = "Number of weeks")
```
n<30 and not normal distribution: assumption for t-test not satisfied

```{r depression-assumptions-2020, echo = FALSE}
ggplot(data = dtrends2020, mapping = aes(x = depression)) +
  geom_histogram(color = "snow3", fill = "cadetblue3", binwidth = 1)+ 
  labs(title = "depression searches by week in April 2020 are not normally distributed", 
       x = "depression searches", 
       y = "number of weeeks")
```
n<30 and not normal distribution: assumption for t-test not satisfied

```{r, depression-year-analysis, echo = FALSE}
d2020 <- dtrends2020 %>% 
  select(depression) %>% 
  pull()

d2018 <- dtrends2018 %>% 
  select(depression) %>% 
  pull()

t.test(d2020, d2018, mu = 0, 
       alternative = "two.sided", 
       paired = TRUE, 
       var.equal = FALSE,
       conf.level = 0.95)
```

The null hypothesis is that there is no difference in the mean amount of depression searches in the US between the times of April 2020 and April 2018. The alternate hypothesis is that there is a difference between the two means. Assuming that the null hypothesis is true, the model follows a t-distribution. The t-statistic is 0.755 and the df = 29. This corresponds to a p-value of 0.4561. We cannot reject the null at the alpha = 0.05 level. We do not have enough evidence to claim that there is a difference in the mean amount of depression searches in the US between the times of April 2020 and April 2018. 

### COVID cases vs. depression rate
```{r variables, echo = FALSE}
covidrate <- covidrate %>%
  mutate(case_cat = case_when(
    New.COVID.cases.per.100.000.in.April <= 91 ~ "low",
    New.COVID.cases.per.100.000.in.April > 91 & New.COVID.cases.per.100.000.in.April < 200 ~ "medium",
    New.COVID.cases.per.100.000.in.April >= 200 ~ "high"
  ))
```

```{r covid-depression-assumptions, echo = FALSE}
ggplot(data = covidrate, mapping = aes(x = depression)) +
  geom_histogram(color = "dodgerblue", fill = "lightsteelblue", binwidth = 1)+
  facet_grid(case_cat~.) +
  labs(title = "Depression search trends for states with high COVID cases has a normal distribution?", 
       x = "depression searches", 
       y = "number of states")
```
The outcomes within each group is not normal. The depression search trends for states with medium numbers of COVID cases and low numbers of COVID cases do not have a normal distribution, and n<30. Therefore, this assumption is not satisfied. By looking at the graphs, it also seems that there is not equal variance among each group, not satisfying the assumption of homoscedastic variance. In addition, these samples may not all be independent. Some states may have the same values/cultures as others, causing the people who live in each state to react to the virus similarly to each other and affecting the depression searches within those states. Therefore, the assumptions for ANOVA are not satisfied. 

```{r ANOVA-test-depression-covid, echo = FALSE}
death_by_case <- aov(depression ~ case_cat, data = covidrate)
summary(death_by_case)
```
The null is that there is no significant difference between the mean depression trends of states with low COVID cases, medium COVID cases, and high COVID cases. The alternate hypothesis is that there exists at least one mean that is different. Assuming the null hypothesis is true, the model follows an F distribution with a df of 2. The F-statistic is 1.334, and the corresponding p-value is 0.273. Therefore, we can not reject the null under the alpha = 0.05 significance level. There is not enough evidence to suggest that there is at least one difference in mean depression trends of states with low, medium, and high COVID cases.

### Restrictions vs. depression
```{r restrictions-depression, echo = FALSE}
covidrate <- covidrate %>%
  mutate(restriction_cat = case_when(
    restriction <= 15 ~ "low",
    restriction >= 15 & restriction <= 33 ~ "medium",
    restriction > 33 ~ "high"
  ))
```

```{r restriction-depression-assumptions, echo = FALSE}
ggplot(data = covidrate, mapping = aes(x = depression)) +
  geom_histogram(color = "lavender", fill = "mediumpurple", binwidth = 1)+
  facet_grid(restriction_cat~.) +
  labs(title = "Depression search trends for states with high restrictions has a normal distribution?", 
       x = "depression searches", 
       y = "number of states")
```
Looking at the graphs, outcomes within groups are not normally distributed for low and medium restriction level states, so this assumption is not satisfied. It also looks like the within-group variance among all groups is not the same, so the assumption for homoscedastic variance is not satisfied. The samples are also not independent because states with similar values that live close to each other my have similar anxiety search trends. The assumptions for ANOVA are not satisfied. 

```{r ANOVA-test-restriction-depression, echo = FALSE}
restriction_by_case <- aov(depression ~ restriction_cat, data = covidrate)
summary(restriction_by_case)

```
The null is that there is no significant difference between the mean depression trends of states with low restrictions, medium restrictions, and high restrictions. The alternate hypothesis is that there exists at least one mean that is different. Assuming the null hypothesis is true, the model follows an F distribution with a df of 2. The F-statistic is 0.516, and the corresponding p-value is 0.6. Therefore, we can not reject the null under the alpha = 0.05 significance level. There is not enough evidence to suggest that there is at least one difference in mean depression trends of states with low, medium, and high restrictions.

### Comparing anxiety trends in April 2020 to April 2018
```{r anxiety-assumptions-2018}
ggplot(data = atrends2018, mapping = aes(x = anxiety)) +
  geom_histogram(color = "snow3", fill = "cornflowerblue", binwidth = 1)+ 
  labs(title = "anxiety searches by week in April 2020 are normally distributed", 
       x = "anxiety searches", 
       y = "number of weeeks")
```
n<30, but has a normal distribution?? : assumption satisfied

```{r anxiety-assumptions-2020}
ggplot(data = atrends2020, mapping = aes(x = anxiety)) +
  geom_histogram(color = "snow3", fill = "lightsteelblue", binwidth = 1)+ 
  labs(title = "anxiety searches by week in April 2020 are not normally distributed", 
       x = "anxiety searches", 
       y = "number of weeeks")
```
n<30 and not normal distribution: assumption not satisfied

```{r, echo = FALSE}
a2020 <- atrends2020 %>% 
  select(anxiety) %>% 
  pull()

a2018 <- atrends2018 %>% 
  select(anxiety) %>% 
  pull()

t.test(a2020, a2018, mu = 0, 
       alternative = "two.sided", 
       paired = TRUE, 
       var.equal = FALSE,
       conf.level = 0.95)
```
The null hypothesis is that there is no difference in the mean amount of anxiety searches in the US between the times of April 2020 and April 2018. The alternate hypothesis is that there is a difference between the two means. Assuming that the null hypothesis is true, the model follows a t-distribution. The t-statistic is 1.66 and the df = 29. This corresponds to a p-value of 0.1086. We cannot reject the null at the alpha = 0.05 level. We do not have enough evidence to claim that there is a difference in the mean amount of anxiety searches in the US between the times of April 2020 and April 2018. 

### COVID cases vs. anxiety rate

```{r covid-anxiety-assumptions, echo = FALSE}
ggplot(data = covidrate, mapping = aes(x = anxiety)) +
  geom_histogram(color = "darkgrey", fill = "lightcyan2", binwidth = 1)+
  facet_grid(case_cat~.) +
  labs(title = "Anxiety search trends for all levels of COVID cases do not have normal distributions", 
       x = "anxiety searches", 
       y = "number of states")
```
Looking at the graphs, outcomes within groups are not normally distributed for any level of COVID cases, so this assumption is not satisfied. It also looks like the within-group variance among all groups is not the same, so the assumption for homoscedastic variance is not satisfied. The samples are also not independent because states with similar values that live close to each other my have similar anxiety search trends. The assumptions for ANOVA are not satisfied. 

```{r ANOVA-test-anxiety, echo = FALSE}
aCOVID_by_rate <- aov(anxiety ~ case_cat, data = covidrate)
summary(aCOVID_by_rate)
```
The null is that there is no significant difference between the mean anxiety trends of states with low COVID cases, medium COVID cases, and high COVID cases. The alternate hypothesis is that there exists at least one mean that is different. Assuming the null hypothesis is true, the model follows an F distribution with a df of 2. The F-statistic is 3.826, and the corresponding p-value is 0.0287. Therefore, we can reject the null under the alpha = 0.05 significance level. There is  enough evidence to suggest that there is at least one difference in mean anxiety trends of states with low, medium, and high COVID cases.

### Restrictions vs. anxiety
```{r restriction-anxiety-assumptions, echo = FALSE}
ggplot(data = covidrate, mapping = aes(x = anxiety)) +
  geom_histogram(color = "cornsilk2", fill = "hotpink4", binwidth = 1)+
  facet_grid(restriction_cat~.) +
  labs(title = "anxiety search trends for all restriction levels do not have normal distributions", 
       x = "anxiety searches", 
       y = "number of states")
```
Looking at the graphs, outcomes within groups are not normally distributed for any level of COVID cases, so this assumption is not satisfied. It also looks like the within-group variance among all groups is not the same, so the assumption for homoscedastic variance is not satisfied. The samples are also not independent because states with similar values that live close to each other my have similar anxiety search trends. The assumptions for ANOVA are not satisfied. 

```{r ANOVA-test-restriction-anxiety, echo = FALSE}
a_restriction_by_case <- aov(anxiety ~ restriction_cat, data = covidrate)
summary(a_restriction_by_case)
```
The null is that there is no significant difference between the mean anxiety trends of states with low restrictions, medium restrictions, and high restrictions. The alternate hypothesis is that there exists at least one mean that is different. Assuming the null hypothesis is true, the model follows an F distribution with a df of 2. The F-statistic is 6.746, and the corresponding p-value is 0.00262. Therefore, we reject the null under the alpha = 0.05 significance level. There is enough evidence to suggest that there is at least one difference in mean anxiety trends of states with low, medium, and high restrictions.

### Depression rate in each state map
```{r graph, echo = FALSE}
library(usmap)
library(ggplot2)

plot_usmap(data = dstate, values = "depression", color = "black") + 
  scale_fill_gradient(name = "depression searches", low = "azure1", high ="cadetblue4") +
  theme(legend.position = "right")
```

#### Nour Visuals 

#### Effect of COVID on depression rates in each State 
```{r depressionVScovid}
ggplot(covidrate, aes(New.COVID.cases.per.100.000.in.April, depression)) +
  geom_point(shape=1) +
   geom_smooth(method=lm) +
  labs(title = "No correlation", 
       x = "New COVID-19 cases (per 100,000) ", 
       y = "Google searches for depression (relative to state)" )
```
The above scatterplot shows the relative google searches for depression among the 50 american states as a function of new COVID-19 cases per 100,000 during the month of april, 2020.
The line of best fit (in blue) is horizontal with R = approximately zero. Thus, we cannot see any correlation between the new COVID-19 cases and the google searches for depression for the month of april.  


#### Effect of COVID on anxiety rates in each State 
```{r anxietyVScovid}
ggplot(covidrate, aes(New.COVID.cases.per.100.000.in.April, anxiety)) +
  geom_point(shape=1) +
   geom_smooth(method=lm) +
  labs(title = "More COVID cases assosciated with higher anxiety", 
       x = "COVID-19 infection rate (per 100,000) ", 
       y = "Google searches for anxiety (relative to state)" )
```

The above scatterplot shows the relative google searches for anxiety among the 50 american states as a function of new COVID-19 cases per 100,000 during the month of april, 2020.
The line of best fit (in blue) has a positive slope. Thus, we can conclude that there's a correlation between anxiety searches and new COVID cases during the month of april. The more new COVID cases a state records, the higher anxiety searches it's expected to have.  

#### Restrictions effect on anxiety rates 

```{r anxietyVSrestrictions}
covidrate %>% 
  mutate( type=ifelse(restriction_cat=="high","Highlighted","Normal")) %>% ggplot( aes(x=restriction_cat, y=anxiety, fill=type, alpha=type)) + 
    geom_boxplot() +
    scale_fill_manual(values=c("#69b3a2", "grey")) +
    scale_alpha_manual(values=c(1,0.1)) +
    theme(legend.position = "none") +
    labs(title = "Higher restrictions associated with higher anxiety", 
       x = "Restrictions", 
       y = "Google searches for anxiety")
```

The above boxplot shows that the states with the highest COVID-related restrictions also record the highest google searches for anxiety compared to the states with low or moderate COVID-related restrictions. We notice that the highlighted box corresponding to the high restrictions states shows the highest median (approximately 87 compared to 78 and 79) and the highest maximum (approximately 97) and minimum (Approximately 76) upon excluding the extreme outliers in the medium group. 

#### Are states with the most restrictions and the most covid cases the most anxious? 

```{r interaction}
covidrate %>%
mutate(Status= case_when(restriction_cat=="high" & case_cat=="high" ~ "Status A"))  %>%
select(State, Status, anxiety)
```
#### Are people more anxious of COVID or restrictions?






