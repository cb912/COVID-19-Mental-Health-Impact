---
title: "Final Project"
author: "Brenda Yang, Charlie Bonetti, Nour Kanaan"
date: "7/19/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(gdata)
library(tidyverse)
library(sf)
library(readxl)
```

```{r data-variables, echo = FALSE}
dstate = read.xls("data/state depression rates 2020.xls")
astate = read.xls("data/State anxiety trends 2020.xls")
dtrends2020 = read.xls("data/April 2020 depression trends.xls")
dtrends2018 = read.xls("data/April 2018 depression trends.xls")
atrends2020 = read.xls("data/April 2020 anxiety trends.xls")
atrends2018 = read.xls("data/April 2018 anxiety trends.xls")
restrictions = read.csv("data/restriction rankings.csv")
covidrate = read.xls("data/COVID by state:d.xls")
```

### Comparing depression trends between April 2020 and April 2018


```{r, depression-year-comparison, echo = FALSE}
d2020 <- dtrends2020 %>% 
  select(depression) %>% 
  pull()

d2018 <- dtrends2018 %>% 
  select(depression) %>% 
  pull()

t.test(d2020, d2018, mu = 0, 
       alternative = "two.sided", 
       paired = TRUE, 
       var.equal = FALSE,
       conf.level = 0.95)
```

The null hypothesis is that there is no difference in the mean amount of depression searches in the US between the times of April 2020 and April 2018. The alternate hypothesis is that there is a difference between the two means. Assuming that the null hypothesis is true, the model follows a t-distribution. The t-statistic is 0.755 and the df = 29. This corresponds to a p-value of 0.4561. We cannot reject the null at the alpha = 0.05 level. We do not have enough evidence to claim that there is a difference in the mean amount of depression searches in the US between the times of April 2020 and April 2018. 

### COVID cases vs. depression rate
```{r variables, echo = FALSE}
covidrate <- covidrate %>%
  mutate(case_cat = case_when(
    New.COVID.cases.per.100.000.in.April <= 91 ~ "low",
    New.COVID.cases.per.100.000.in.April > 91 & New.COVID.cases.per.100.000.in.April < 200 ~ "medium",
    New.COVID.cases.per.100.000.in.April >= 200 ~ "high"
  ))
```

```{r ANOVA-test, echo = FALSE}
death_by_case <- aov(depression ~ case_cat, data = covidrate)
summary(death_by_case)
```
The null is that there is no significant difference between the mean depression trends of states with low COVID cases, medium COVID cases, and high COVID cases. The alternate hypothesis is that there exists at least one mean that is different. Assuming the null hypothesis is true, the model follows an F distribution with a df of 2. The F-statistic is 1.334, and the corresponding p-value is 0.273. Therefore, we can not reject the null under the alpha = 0.05 significance level. There is not enough evidence to suggest that there is at least one difference in mean depression trends of states with low, medium, and high COVID cases.

### Comparing anxiety trends in April 2020 to April 2018
```{r, echo = FALSE}
a2020 <- atrends2020 %>% 
  select(anxiety) %>% 
  pull()

a2018 <- atrends2018 %>% 
  select(anxiety) %>% 
  pull()

t.test(a2020, a2018, mu = 0, 
       alternative = "two.sided", 
       paired = TRUE, 
       var.equal = FALSE,
       conf.level = 0.95)
```
The null hypothesis is that there is no difference in the mean amount of anxiety searches in the US between the times of April 2020 and April 2018. The alternate hypothesis is that there is a difference between the two means. Assuming that the null hypothesis is true, the model follows a t-distribution. The t-statistic is 1.66 and the df = 29. This corresponds to a p-value of 0.1086. We cannot reject the null at the alpha = 0.05 level. We do not have enough evidence to claim that there is a difference in the mean amount of anxiety searches in the US between the times of April 2020 and April 2018. 

### COVID cases vs. anxiety rate

```{r ANOVA-test-anxiety, echo = FALSE}
restriction_by_case <- aov(anxiety ~ case_cat, data = covidrate)
summary(restriction_by_case)
```
The null is that there is no significant difference between the mean anxiety trends of states with low COVID cases, medium COVID cases, and high COVID cases. The alternate hypothesis is that there exists at least one mean that is different. Assuming the null hypothesis is true, the model follows an F distribution with a df of 2. The F-statistic is 3.826, and the corresponding p-value is 0.0287. Therefore, we can reject the null under the alpha = 0.05 significance level. There is  enough evidence to suggest that there is at least one difference in mean anxiety trends of states with low, medium, and high COVID cases.

### Depression rate in each state map
```{r graph, echo = FALSE}
library(usmap)
library(ggplot2)

plot_usmap(data = dstate, values = "depression", color = "red") + 
  scale_fill_continuous(name = "depression searches", label = scales::comma) + 
  theme(legend.position = "right")
```

#### Nour Visuals 

```{r}
State_trends1 <- merge(astate, dstate, by= "state")
State_trends3 <- merge(restriction_rankings, stateCovid, by= "state")
State_Data <- merge(State_trends1,State_trends3, by= "state")
State_final <- State_Data %>% 
  select(state, anxiety, depression, '5-May', `New COVID cases per 100,000 in April`)
covidrate_rank <- State_final %>%
  select(`New COVID cases per 100,000 in April`)  %>%
  mutate(case_cat = case_when(
    `New COVID cases per 100,000 in April` <= 91 ~ "low",
    `New COVID cases per 100,000 in April` > 91 & `New COVID cases per 100,000 in April` < 200 ~ "medium",
    `New COVID cases per 100,000 in April` >= 200 ~ "high"))
```

```{r}
require(reshape)
State_final <- rename(State_final,c('New COVID cases per 100,000 in April'= "COVID_Rate"))
State_final <- rename(State_final,c('May-5'= "restriction_ranks"))
``` 


#### Effect of COVID on depression/anxiety rates in each State 
```{r}
ggplot(data = State_final, mapping = aes(x = COVID_Rate, y = depression)) +
  geom_point() +
  labs(title = "No trend", 
       x = "COVID-19 infection rate (per 100,000) ", 
       y = "Google searches for depression (relative to state)" )

ggplot(data = State_final, mapping = aes(x = COVID_Rate, y = anxiety)) +
  geom_point() +
  labs(title = "Curvilinear?", 
       x = "COVID-19 infection rate (per 100,000) ", 
       y = "Google searches for anxiety (relative to state)" )
```

#### Effect of severity of restrictions on depression/anxiety rates in each State


