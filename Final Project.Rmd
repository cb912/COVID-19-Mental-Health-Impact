---
title: "Final Project"
author: "Brenda Yang, Charlie Bonetti, Nour Kanaan"
date: "7/19/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(gdata)
library(tidyverse)
library(sf)
library(readxl)
```

```{r data-variables, echo = FALSE}
dstate = read.xls("data/state depression rates 2020.xls")
astate = read.xls("data/State anxiety trends 2020.xls")
dtrends2020 = read.xls("data/April 2020 depression trends.xls")
dtrends2018 = read.xls("data/April 2018 depression trends.xls")
atrends2020 = read.xls("data/April 2020 anxiety trends.xls")
atrends2018 = read.xls("data/April 2018 anxiety trends.xls")
restrictions = read.csv("data/restriction rankings.csv")
covidrate = read.xls("data/all_data.xls")
```

### Comparing depression trends between April 2020 and April 2018
```{r depression-assumptions-2018, echo = FALSE}
ggplot(data = dtrends2018, mapping = aes(x = depression)) +
  geom_histogram(color = "snow3", fill = "mediumaquamarine", binwidth = 1)+ 
  labs(title = "depression searches by week in April 2020 are not normally distributed", 
       x = "depression searches", 
       y = "Number of weeks")
```
n<30 and not normal distribution: assumption for t-test not satisfied

```{r depression-assumptions-2020, echo = FALSE}
ggplot(data = dtrends2020, mapping = aes(x = depression)) +
  geom_histogram(color = "snow3", fill = "cadetblue3", binwidth = 1)+ 
  labs(title = "depression searches by week in April 2020 are not normally distributed", 
       x = "depression searches", 
       y = "number of weeeks")
```
n<30 and not normal distribution: assumption for t-test not satisfied

```{r, depression-year-analysis, echo = FALSE}
d2020 <- dtrends2020 %>% 
  select(depression) %>% 
  pull()

d2018 <- dtrends2018 %>% 
  select(depression) %>% 
  pull()

t.test(d2020, d2018, mu = 0, 
       alternative = "two.sided", 
       paired = TRUE, 
       var.equal = FALSE,
       conf.level = 0.95)
```

The null hypothesis is that there is no difference in the mean amount of depression searches in the US between the times of April 2020 and April 2018. The alternate hypothesis is that there is a difference between the two means. Assuming that the null hypothesis is true, the model follows a t-distribution. The t-statistic is 0.755 and the df = 29. This corresponds to a p-value of 0.4561. We cannot reject the null at the alpha = 0.05 level. We do not have enough evidence to claim that there is a difference in the mean amount of depression searches in the US between the times of April 2020 and April 2018. 

### COVID cases vs. depression rate
```{r variables, echo = FALSE}
covidrate <- covidrate %>%
  mutate(case_cat = case_when(
    New.COVID.cases.per.100.000.in.April <= 91 ~ "low",
    New.COVID.cases.per.100.000.in.April > 91 & New.COVID.cases.per.100.000.in.April < 200 ~ "medium",
    New.COVID.cases.per.100.000.in.April >= 200 ~ "high"
  ))
```

```{r covid-depression-assumptions, echo = FALSE}
covidrate %>%
  filter(case_cat == "low")
```

```{r ANOVA-test-depression-covid, echo = FALSE}
death_by_case <- aov(depression ~ case_cat, data = covidrate)
summary(death_by_case)
```
The null is that there is no significant difference between the mean depression trends of states with low COVID cases, medium COVID cases, and high COVID cases. The alternate hypothesis is that there exists at least one mean that is different. Assuming the null hypothesis is true, the model follows an F distribution with a df of 2. The F-statistic is 1.334, and the corresponding p-value is 0.273. Therefore, we can not reject the null under the alpha = 0.05 significance level. There is not enough evidence to suggest that there is at least one difference in mean depression trends of states with low, medium, and high COVID cases.

### Restrictions vs. depression
```{r restrictions-depression, echo = FALSE}
covidrate <- covidrate %>%
  mutate(restriction_cat = case_when(
    restriction <= 15 ~ "low",
    restriction >= 15 & restriction <= 33 ~ "medium",
    restriction > 33 ~ "high"
  ))
```

```{r ANOVA-test-restriction-depression, echo = FALSE}
restriction_by_case <- aov(depression ~ restriction_cat, data = covidrate)
summary(restriction_by_case)

```
The null is that there is no significant difference between the mean depression trends of states with low restrictions, medium restrictions, and high restrictions. The alternate hypothesis is that there exists at least one mean that is different. Assuming the null hypothesis is true, the model follows an F distribution with a df of 2. The F-statistic is 0.516, and the corresponding p-value is 0.6. Therefore, we can not reject the null under the alpha = 0.05 significance level. There is not enough evidence to suggest that there is at least one difference in mean depression trends of states with low, medium, and high restrictions.

### Comparing anxiety trends in April 2020 to April 2018
```{r anxiety-assumptions-2018}
ggplot(data = atrends2018, mapping = aes(x = anxiety)) +
  geom_histogram(color = "snow3", fill = "cornflowerblue", binwidth = 1)+ 
  labs(title = "anxiety searches by week in April 2020 are normally distributed", 
       x = "anxiety searches", 
       y = "number of weeeks")
```
n<30, but has a normal distribution?? : assumption satisfied

```{r anxiety-assumptions-2020}
ggplot(data = atrends2020, mapping = aes(x = anxiety)) +
  geom_histogram(color = "snow3", fill = "lightsteelblue", binwidth = 1)+ 
  labs(title = "anxiety searches by week in April 2020 are not normally distributed", 
       x = "anxiety searches", 
       y = "number of weeeks")
```
n<30 and not normal distribution: assumption not satisfied

```{r, echo = FALSE}
a2020 <- atrends2020 %>% 
  select(anxiety) %>% 
  pull()

a2018 <- atrends2018 %>% 
  select(anxiety) %>% 
  pull()

t.test(a2020, a2018, mu = 0, 
       alternative = "two.sided", 
       paired = TRUE, 
       var.equal = FALSE,
       conf.level = 0.95)
```
The null hypothesis is that there is no difference in the mean amount of anxiety searches in the US between the times of April 2020 and April 2018. The alternate hypothesis is that there is a difference between the two means. Assuming that the null hypothesis is true, the model follows a t-distribution. The t-statistic is 1.66 and the df = 29. This corresponds to a p-value of 0.1086. We cannot reject the null at the alpha = 0.05 level. We do not have enough evidence to claim that there is a difference in the mean amount of anxiety searches in the US between the times of April 2020 and April 2018. 

### COVID cases vs. anxiety rate

```{r ANOVA-test-anxiety, echo = FALSE}
aCOVID_by_rate <- aov(anxiety ~ case_cat, data = covidrate)
summary(aCOVID_by_rate)
```
The null is that there is no significant difference between the mean anxiety trends of states with low COVID cases, medium COVID cases, and high COVID cases. The alternate hypothesis is that there exists at least one mean that is different. Assuming the null hypothesis is true, the model follows an F distribution with a df of 2. The F-statistic is 3.826, and the corresponding p-value is 0.0287. Therefore, we can reject the null under the alpha = 0.05 significance level. There is  enough evidence to suggest that there is at least one difference in mean anxiety trends of states with low, medium, and high COVID cases.

### Restrictions vs. anxiety
```{r ANOVA-test-restriction-anxiety, echo = FALSE}
a_restriction_by_case <- aov(anxiety ~ restriction_cat, data = covidrate)
summary(a_restriction_by_case)
```
The null is that there is no significant difference between the mean anxiety trends of states with low restrictions, medium restrictions, and high restrictions. The alternate hypothesis is that there exists at least one mean that is different. Assuming the null hypothesis is true, the model follows an F distribution with a df of 2. The F-statistic is 6.746, and the corresponding p-value is 0.00262. Therefore, we reject the null under the alpha = 0.05 significance level. There is enough evidence to suggest that there is at least one difference in mean anxiety trends of states with low, medium, and high restrictions.

### Depression rate in each state map
```{r graph, echo = FALSE}
library(usmap)
library(ggplot2)

plot_usmap(data = dstate, values = "depression", color = "black") + 
  scale_fill_gradient(name = "depression searches", low = "azure1", high ="cadetblue4") +
  theme(legend.position = "right")
```

#### Nour Visuals 

#### Effect of COVID on depression/anxiety rates in each State 
```{r covid vs. depression}
ggplot(data = covidrate, mapping = aes(x = New.COVID.cases.per.100.000.in.April, y = depression)) +
  geom_point(color= "red") +
  labs(title = "No trend", 
       x = "COVID-19 infection rate (per 100,000) ", 
       y = "Google searches for depression (relative to state)" )
```


```{r}
ggplot(data = covidrate, mapping = aes(x = New.COVID.cases.per.100.000.in.April, y = anxiety)) +
  geom_point(color= "orange") + facet_grid(party~.) + 
  labs(title = "No trend", 
       x = "COVID-19 infection rate (per 100,000) ", 
       y = "Google searches for anxiety (relative to state)" )
```


#### Effect of severity of restrictions on depression/anxiety rates in each State

```{r restrictions depression}
ggplot(data = covidrate, mapping = aes(x = restriction_cat, y = depression, fill= restriction_cat)) + 
  geom_boxplot() + 
  labs(title = "Higher restrictions associated with lower depression", 
       x = "Restrictions", 
       y = "Google searches for depression")
```

```{r restrrictionsanxiety}
ggplot(data = covidrate, mapping = aes(x = restriction_cat, y = anxiety, fill= restriction_cat)) + 
  geom_boxplot() + 
  labs(title = "Higher restrictions associated with higher anxiety", 
       x = "Restrictions", 
       y = "Google searches for anxiety")
```


#### How does the severity of restrictions affect the relationship between anxiety and COVID rates in the 50 states 

```{r COVIDRESTRICTIONS}
ggplot(data = covidrate, mapping = aes(x = New.COVID.cases.per.100.000.in.April, y = depression)) +
  geom_line() + 
  geom_point() + 
  labs(title = "Obesity by State", 
       x = "State", 
       y = "Adult Obesity (%)")
```


```{r}

```

